<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Banco de Palabras - Valari</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body>
    <header>
        <div class="logo">
            <i class="fa-solid fa-language"></i>
            <span>Banco de palabras</span>
        </div>
    </header>

    <main class="centered">
        <div class="container">
            <h1>Diccionario Valari</h1>
            <p>Aqu√≠ puedes consultar todas las palabras disponibles en el traductor:</p>

            <div class="search-controls">
                <input type="text" id="busqueda" placeholder="üîç Buscar palabra..." />
                <select id="criterio-busqueda">
                    <option value="ambos">Buscar en Ambos</option>
                    <option value="ingles">Buscar en Ingl√©s</option>
                    <option value="valari">Buscar en Valari</option>
                </select>
            </div>
            
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Ingl√©s</th>
                            <th>Valari</th>
                        </tr>
                    </thead>
                    <tbody id="tabla-palabras">
                        </tbody>
                </table>
            </div>

            <div style="margin-top: 30px;">
                <a href="index.html" class="btn-volver">‚¨Ö Volver al traductor</a>
            </div>
        </div>
    </main>

    <footer>
        <p>Traductor de mierda ‚Äî Creado con Culo ü©∑</p>
    </footer>

    <script src="script.js"></script> 
    
    <script>
        // Aseg√∫rate de que valariDict est√° disponible globalmente desde script.js
        if (typeof valariDict === 'undefined') {
            console.error("Error: El diccionario 'valariDict' no est√° cargado. Aseg√∫rate de que script.js est√© correctamente vinculado.");
        }

        const tabla = document.getElementById("tabla-palabras");
        const busqueda = document.getElementById("busqueda");
        const criterioBusqueda = document.getElementById("criterio-busqueda");

        /**
         * Calcula un puntaje de relevancia para la palabra encontrada.
         * Puntaje: 3 (Exacta) > 2 (Empieza con) > 1 (Contiene)
         * @param {string} text - El texto a evaluar (Ingl√©s o Valari).
         * @param {string} filtro - El t√©rmino de b√∫squeda en min√∫sculas.
         * @returns {number} Puntaje de relevancia.
         */
        function calcularRelevancia(text, filtro) {
            if (!filtro) return 0;

            const textLower = text.toLowerCase();
            
            // 1. Coincidencia EXACTA (M√°xima prioridad)
            if (textLower === filtro) {
                return 3;
            } 
            
            // 2. Coincidencia al INICIO de la palabra (Alta prioridad)
            if (textLower.startsWith(filtro)) {
                return 2;
            } 
            
            // 3. Coincidencia PARCIAL (Menor prioridad)
            if (textLower.includes(filtro)) {
                return 1;
            } 
            
            return 0;
        }

        // Funci√≥n para llenar y ordenar la tabla
        function cargarTabla(filtro = "", criterio = "ambos") {
            tabla.innerHTML = ""; 

            // Si el filtro est√° vac√≠o, volvemos a la tabla completa ordenada alfab√©ticamente
            if (!filtro) {
                // Mantenemos el orden alfab√©tico original
                const palabrasOrdenadas = Object.keys(valariDict).sort();
                
                let contador = 1; 
                palabrasOrdenadas.forEach(ing => {
                    const fila = document.createElement("tr");
                    fila.innerHTML = `<td>${contador}</td><td>${ing}</td><td>${valariDict[ing]}</td>`;
                    tabla.appendChild(fila);
                    contador++;
                });
                return;
            }

            const palabrasOrdenadas = Object.keys(valariDict).sort();
            const filtroLower = filtro.toLowerCase();
            const resultadosFiltrados = [];

            palabrasOrdenadas.forEach(ing => {
                const valari = valariDict[ing];
                const ingLower = ing.toLowerCase();
                const valariLower = valari.toLowerCase();
                
                let cumpleFiltro = false;
                let relevancia = 0;
                let textoBusqueda = "";

                // L√≥gica de FILTRADO y determinaci√≥n del texto a puntuar
                if (criterio === "ingles" && ingLower.includes(filtroLower)) {
                    cumpleFiltro = true;
                    textoBusqueda = ing;
                } else if (criterio === "valari" && valariLower.includes(filtroLower)) {
                    cumpleFiltro = true;
                    textoBusqueda = valari;
                } else if (criterio === "ambos" && (ingLower.includes(filtroLower) || valariLower.includes(filtroLower))) {
                    cumpleFiltro = true;
                    // En "ambos", priorizamos la coincidencia en Ingl√©s para el puntaje.
                    textoBusqueda = ingLower.includes(filtroLower) ? ing : valari;
                }

                // Si cumple el filtro, calcula la relevancia y guarda el resultado
                if (cumpleFiltro) {
                    relevancia = calcularRelevancia(textoBusqueda, filtroLower);
                    resultadosFiltrados.push({
                        ing: ing,
                        valari: valari,
                        relevancia: relevancia,
                        // Usar la palabra en ingl√©s para el desempate por orden alfab√©tico
                        ordenAlfabetico: ingLower 
                    });
                }
            });

            // 3. L√≥gica de ORDENAMIENTO: Ordena por Relevancia (descendente) y luego por Orden Alfab√©tico
            resultadosFiltrados.sort((a, b) => {
                // Primero, compara por relevancia (los puntajes m√°s altos van primero)
                if (b.relevancia !== a.relevancia) {
                    return b.relevancia - a.relevancia;
                }
                // Segundo, si las relevancias son iguales, ordena alfab√©ticamente
                if (a.ordenAlfabetico < b.ordenAlfabetico) {
                    return -1;
                }
                if (a.ordenAlfabetico > b.ordenAlfabetico) {
                    return 1;
                }
                return 0;
            });

            // 4. Renderizado: Renderiza los resultados ordenados en la tabla
            let contador = 1; 
            resultadosFiltrados.forEach(item => {
                const fila = document.createElement("tr");
                fila.innerHTML = `<td>${contador}</td><td>${item.ing}</td><td>${item.valari}</td>`;
                tabla.appendChild(fila);
                contador++; 
            });
        }

        // Inicializar tabla al cargar la p√°gina (muestra todo ordenado alfab√©ticamente)
        cargarTabla();

        // Funci√≥n para manejar el evento de cambio en el selector o la caja de b√∫squeda
        const manejarBusqueda = () => {
            const filtro = busqueda.value;
            const criterio = criterioBusqueda.value;
            cargarTabla(filtro, criterio);
        };

        // Escuchar eventos en la caja de b√∫squeda y en el selector
        busqueda.addEventListener("input", manejarBusqueda);
        criterioBusqueda.addEventListener("change", manejarBusqueda);
    </script>
</body>
</html>